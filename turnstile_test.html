<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnstile Test</title>
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
    <h1>Cloudflare Turnstile Test</h1>
    <form id="test-form">
        <div class="cf-turnstile" data-sitekey="0x4AAAAAABnyQIvR42qq5_Ed" data-callback="onTurnstileSuccess"></div>
        <button type="submit" disabled>Submit</button>
    </form>

    <script>
        function onTurnstileSuccess(token) {
            console.log("Turnstile success:", token);
            document.querySelector('#test-form button').disabled = false;

            fetch('https://api-cruiz.vercel.app/validate-captcha', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ captchaToken: token, action: 'test_form', timestamp: Date.now() }),
            })
            .then(response => response.json())
            .then(data => {
                console.log("Validation response:", data);
                if (data.success) {
                    alert("Validation successful!");
                } else {
                    alert("Validation failed: " + JSON.stringify(data['error-codes']));
                }
            })
            .catch(error => {
                console.error("Error validating token:", error);
                alert("An error occurred during validation.");
            });
        }
    </script>
</body>
</html>
